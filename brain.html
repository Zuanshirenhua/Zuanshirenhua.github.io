<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Då¤§è„‘æ¢ç´¢å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, white);
            overflow: hidden;
            color: white;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 350px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateX(-380px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        #info-panel.show {
            transform: translateX(0);
        }
        
        #info-panel h2 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 1.4em;
        }
        
        #info-panel h3 {
            color: #81c784;
            margin: 15px 0 8px 0;
            font-size: 1.1em;
        }
        
        #info-panel p {
            line-height: 1.6;
            margin-bottom: 10px;
            color: #e0e0e0;
        }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 300px;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 18px;
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #64b5f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #64b5f6;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }
        
        .close-btn:hover {
            color: white;
        }

    </style>
</head>
<body>
    <div id="container">
        <div id="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨åŠ è½½3Då¤§è„‘æ¨¡å‹...</p>
        </div>
        
        <div id="info-panel">
            <button class="close-btn" onclick="closeInfoPanel()">&times;</button>
            <h2 id="region-title">å¤§è„‘åŒºåŸŸä¿¡æ¯</h2>
            <p id="region-description">ç‚¹å‡»å¤§è„‘çš„ä»»ä½•åŒºåŸŸæ¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
            <h3>ä¸»è¦åŠŸèƒ½</h3>
            <p id="region-functions">å„ä¸ªå¤§è„‘åŒºåŸŸè´Ÿè´£ä¸åŒçš„è®¤çŸ¥å’Œè¡Œä¸ºåŠŸèƒ½</p>
        </div>
        
        <div id="instructions">
            <strong>æ“ä½œè¯´æ˜ï¼š</strong><br>
            â€¢ æ‹–åŠ¨é¼ æ ‡æ—‹è½¬å¤§è„‘æ¨¡å‹<br>
            â€¢ æ»šè½®ç¼©æ”¾æ¨¡å‹<br>
            â€¢ ç‚¹å‡»ä¸åŒåŒºåŸŸæŸ¥çœ‹åŠŸèƒ½ä»‹ç»
        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, brain, controls;
        let raycaster, mouse;
        let isLoaded = false;
        let threeJSLoaded = false;



                
        // å¤§è„‘åŒºåŸŸä¿¡æ¯æ•°æ®åº“
        const brainRegions = {
            default: {
                title: "å¤§è„‘çš®å±‚",
                description: "å¤§è„‘æ˜¯äººä½“æœ€å¤æ‚çš„å™¨å®˜ï¼Œè´Ÿè´£æ€ç»´ã€æ„ŸçŸ¥ã€è¿åŠ¨æ§åˆ¶å’Œå„ç§é«˜çº§è®¤çŸ¥åŠŸèƒ½ã€‚",
                functions: "æ•´ä½“åè°ƒèº«ä½“å„é¡¹åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ„è¯†ã€è®°å¿†ã€è¯­è¨€ã€æƒ…æ„Ÿå’Œè¿åŠ¨æ§åˆ¶ã€‚"
            },
            frontal: {
                title: "é¢å¶ (Frontal Lobe)",
                description: "ä½äºå¤§è„‘å‰éƒ¨ï¼Œæ˜¯æ‰§è¡ŒåŠŸèƒ½çš„ä¸­å¿ƒï¼ŒåŒ…æ‹¬å‰é¢çš®è´¨ï¼Œè´Ÿè´£é«˜çº§è®¤çŸ¥å¤„ç†ã€‚",
                functions: "æ‰§è¡ŒåŠŸèƒ½ã€å†³ç­–åˆ¶å®šã€å·¥ä½œè®°å¿†ã€æ³¨æ„åŠ›æ§åˆ¶ã€ä¸ªæ€§è¡¨è¾¾ã€è¿åŠ¨è§„åˆ’å’Œè¯­è¨€äº§ç”Ÿï¼ˆå¸ƒæ´›å¡åŒºï¼‰ã€‚"
            },
            parietal: {
                title: "é¡¶å¶ (Parietal Lobe)",
                description: "ä½äºå¤§è„‘é¡¶éƒ¨ï¼Œä¸»è¦å¤„ç†æ„Ÿè§‰ä¿¡æ¯çš„æ•´åˆå’Œç©ºé—´è®¤çŸ¥ã€‚",
                functions: "è§¦è§‰å¤„ç†ã€ç©ºé—´æ„è¯†ã€èº«ä½“æ„ŸçŸ¥ã€æ³¨æ„åŠ›åˆ†é…ã€æ•°å­¦è®¡ç®—å’Œé˜…è¯»ç†è§£ã€‚"
            },
            temporal: {
                title: "é¢å¶ (Temporal Lobe)",
                description: "ä½äºå¤§è„‘ä¸¤ä¾§ï¼ŒåŒ…å«å¬è§‰çš®å±‚å’Œé‡è¦çš„è®°å¿†ç»“æ„å¦‚æµ·é©¬ä½“ã€‚",
                functions: "å¬è§‰å¤„ç†ã€è¯­è¨€ç†è§£ï¼ˆéŸ¦å°¼å…‹åŒºï¼‰ã€é•¿æœŸè®°å¿†å½¢æˆã€æƒ…ç»ªå¤„ç†å’Œé¢éƒ¨è¯†åˆ«ã€‚"
            },
            occipital: {
                title: "æ•å¶ (Occipital Lobe)",
                description: "ä½äºå¤§è„‘åéƒ¨ï¼Œä¸»è¦è´Ÿè´£è§†è§‰ä¿¡æ¯çš„å¤„ç†ã€‚",
                functions: "è§†è§‰å¤„ç†ã€å›¾åƒè¯†åˆ«ã€è‰²å½©æ„ŸçŸ¥ã€è¿åŠ¨è§†è§‰å’Œè§†è§‰-ç©ºé—´å¤„ç†ã€‚"
            },
            cerebellum: {
                title: "å°è„‘ (Cerebellum)",
                description: "ä½äºå¤§è„‘åä¸‹æ–¹ï¼Œè™½ç„¶ä½“ç§¯å°ä½†åŒ…å«å¤§é‡ç¥ç»å…ƒã€‚",
                functions: "è¿åŠ¨åè°ƒã€å¹³è¡¡æ§åˆ¶ã€å§¿åŠ¿ç»´æŒã€è¿åŠ¨å­¦ä¹ å’ŒæŸäº›è®¤çŸ¥åŠŸèƒ½ã€‚"
            },
            brainstem: {
                title: "è„‘å¹² (Brainstem)",
                description: "è¿æ¥å¤§è„‘å’Œè„Šé«“ï¼ŒåŒ…æ‹¬ä¸­è„‘ã€è„‘æ¡¥å’Œå»¶é«“ã€‚",
                functions: "åŸºæœ¬ç”Ÿå‘½åŠŸèƒ½æ§åˆ¶ï¼ˆå‘¼å¸ã€å¿ƒè·³ï¼‰ã€ç¡çœ -è§‰é†’å‘¨æœŸã€åå°„æ§åˆ¶å’Œæ„è¯†è°ƒèŠ‚ã€‚"
            }
        };
        
        function init() {
            // æ£€æŸ¥Three.jsæ˜¯å¦å·²åŠ è½½
            if (typeof THREE === 'undefined') {
                setTimeout(init, 100);
                return;
            }
            
            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf5f5f5);

            const axesHelper = new THREE.AxesHelper(2);
            scene.add(axesHelper);
            const dotGeometry = new THREE.SphereGeometry(1, 16, 16);
            const dotMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            const dot = new THREE.Mesh(dotGeometry, dotMaterial);
            scene.add(dot);
            
            // åˆ›å»ºç›¸æœº
            const aspect = window.innerWidth / window.innerHeight;
            const frustumSize = 5;

            camera = new THREE.OrthographicCamera(
                frustumSize * aspect / -2,
                frustumSize * aspect / 2,
                frustumSize / 2,
                frustumSize / -2,
                0.1,
                100
            );
            camera.position.set(-3, 15, 2); // æˆ–æ ¹æ®éœ€è¦å¾®è°ƒ
            camera.lookAt(0, 0, 0);
            
            // åˆ›å»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 0.7;

            // ç„¶ååˆ›å»ºæ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            // å–æ¶ˆç¼©æ”¾/å¹³ç§»ï¼Œåªä¿ç•™æ—‹è½¬
            controls.enablePan = false;
            controls.enableZoom = false;

            controls.target.set(0, 0, 0);
            controls.update();
            
            // åˆ›å»ºå…‰ç…§
            // æŸ”å’Œçš„ç¯å¢ƒå…‰
            //const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            //scene.add(ambientLight);

            // èƒŒå…‰ï¼šä»æ‘„åƒæœºåæ–¹å‘å†…ç…§
            //const cameraBackLight = new THREE.DirectionalLight(0xffffff, 0.5);
            //cameraBackLight.position.copy(camera.position).normalize();
            //scene.add(cameraBackLight);

            const topLight = new THREE.DirectionalLight(0xffffff, 0.5);
            topLight.position.set(-40, 50, 0); // é¡¶éƒ¨å‚ç›´å‘ä¸‹
            topLight.target.position.set(0, 0, 0);
            scene.add(topLight);
            scene.add(topLight.target); // âœ… ä¸€å®šè¦æŠŠ target åŠ å…¥ scene ä¸­ï¼

            //const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.5);
            //scene.add(hemisphereLight);

            // ä¸»æ–¹å‘å…‰ï¼ˆæ¨¡æ‹Ÿå¤ªé˜³å…‰ï¼‰
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(3, 3, 3);
            scene.add(directionalLight);

            // å¯é€‰ï¼šè¡¥å…‰ç¯ï¼ˆæ¶ˆé™¤é˜´å½±ï¼‰
            //const fillLight = new THREE.PointLight(0xffffff, 0.6);
            //fillLight.position.set(-2, 1, 2);
            //scene.add(fillLight);

            const cameraBackLight = new THREE.DirectionalLight(0xffffff, 0.6);
            cameraBackLight.position.copy(camera.position).normalize();
            scene.add(cameraBackLight);

            // è‡ªåº•éƒ¨å‘ä¸Šç…§çš„æ–¹å‘å…‰
            const bottomUpLight = new THREE.DirectionalLight(0xffffff, 0.6);
            bottomUpLight.position.set(0, -2, 2); // ä»åº•éƒ¨åå‰æ–¹ç…§å°„ä¸Šæ¥
            scene.add(bottomUpLight);

            
            // å°„çº¿æŠ•å°„å™¨å’Œé¼ æ ‡
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // åŠ è½½3Dæ¨¡å‹
            loadBrainModel();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            window.addEventListener('resize', onWindowResize);
            
            // ç­‰å¾…rendererå®Œå…¨åˆå§‹åŒ–åå†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            setTimeout(function() {
                if (renderer && renderer.domElement) {
                    renderer.domElement.addEventListener('click', onMouseClick);
                    renderer.domElement.addEventListener('mousemove', onMouseMove);
                    setupMouseControls();
                }
            }, 100);
            
            // å¼€å§‹æ¸²æŸ“å¾ªç¯
            animate();
        }
        
        function loadBrainModel() {
            const loader = new THREE.GLTFLoader();

            loader.load('https://zuanshirenhua.github.io/images/3Dbrain.glb', function (gltf) {
                const brainGroup = new THREE.Group(); // çˆ¶å®¹å™¨
                brain = gltf.scene;

                // âœ… è®©æ¨¡å‹åœ¨Yè½´æˆ–Zè½´æ—‹è½¬180åº¦ï¼Œè°ƒæ•´ä¸ºæ­£é¢æœä¸Š
                brain.rotation.set(0, Math.PI, 0);

                // âœ… å¹³ç§»åˆ°å‡ ä½•ä¸­å¿ƒä¸º (0,0,0)
                const box = new THREE.Box3().setFromObject(brain);
                const center = new THREE.Vector3();
                box.getCenter(center);
                brain.position.sub(center);

                controls.target.set(0, 0, 0);
                controls.update();


                // âœ… å¯é€‰ï¼šç¼©æ”¾æˆ–å±…ä¸­ä½ç½®
                brain.scale.set(0.015, 0.015, 0.015);
                brain.position.set(0, 0, 0);



                // âœ… ä¿®å¤æ¨¡å‹ï¼šéå†æ‰€æœ‰Meshï¼Œä¿ç•™åŸæè´¨ï¼Œåªåšä»¥ä¸‹ä¿®å¤ï¼š
                brain.traverse(function (child) {


                    if (child.isMesh) {

                        child.material = new THREE.MeshStandardMaterial({
                            color: 0xf2c6b6,           // ç¨åç°ç™½ï¼Œä¸æ˜¯çº¯ç™½
                            roughness: 0.55,           // ç¨å¾®æœ‰å…‰æ³½
                            metalness: 0.05,           // è½»å¾®é‡‘å±åå°„æ„Ÿ
                            side: THREE.DoubleSide,
                            depthWrite: true,
                            polygonOffset: true,
                            polygonOffsetFactor: 1,
                            polygonOffsetUnits: 1
                        });
                        

                        // å¦‚æœæœ‰å‡ ä½•ä½“ï¼Œé‡æ–°è®¡ç®—æ³•çº¿
                        if (child.geometry) {
                            child.geometry.computeVertexNormals();
                        }

                        // è‹¥æ¨¡å‹è´´å›¾æ›å…‰è¿‡åº¦ï¼Œå¯å°è¯•å‹æš—è´´å›¾ï¼ˆå¯é€‰ï¼‰
                        if (child.material && child.material.map) {
                            child.material.map.encoding = THREE.sRGBEncoding;
                            child.material.map.needsUpdate = true;
                        }
                    }
                });

                brainGroup.add(brain); 
                scene.add(brainGroup);

                // ğŸ‘‡ ä¿å­˜çˆ¶å®¹å™¨åˆ°å…¨å±€å˜é‡ä»¥ä¾¿æ—‹è½¬ç”¨
                window.brainGroup = brainGroup;
                isLoaded = true;

                document.getElementById('loading').style.display = 'none';
            }, undefined, function (error) {
                console.error('åŠ è½½æ¨¡å‹å¤±è´¥ï¼š', error);
            });
        }

        
        
        function createDefaultBrain() {
            // åˆ›å»ºä¸€ä¸ªç®€å•çš„å¤§è„‘æ¨¡å‹ä½œä¸ºå¤‡é€‰
            const brainGroup = new THREE.Group();
            brainGroup.add(brain);
            scene.add(brainGroup);
            
            // ä¸»è¦å¤§è„‘åŠçƒ
            const brainGeometry = new THREE.SphereGeometry(1, 32, 16);
            brainGeometry.scale(1.2, 0.8, 1.4);
            
            const brainMaterial = new THREE.MeshPhongMaterial({
                color: 0xfdbcb4,
                shininess: 30,
                transparent: true,
                opacity: 0.9
            });
            
            const mainBrain = new THREE.Mesh(brainGeometry, brainMaterial);
            brainGroup.add(mainBrain);
            
            // å°è„‘
            const cerebellumGeometry = new THREE.SphereGeometry(0.4, 16, 8);
            const cerebellumMaterial = new THREE.MeshPhongMaterial({
                color: 0xe8a29a,
                shininess: 30
            });
            const cerebellum = new THREE.Mesh(cerebellumGeometry, cerebellumMaterial);
            cerebellum.position.set(0, -0.6, -0.8);
            cerebellum.userData.region = 'cerebellum';
            brainGroup.add(cerebellum);
            
            // è„‘å¹²
            const brainstemGeometry = new THREE.CylinderGeometry(0.15, 0.2, 0.8);
            const brainstemMaterial = new THREE.MeshPhongMaterial({
                color: 0xd4998a,
                shininess: 30
            });
            const brainstem = new THREE.Mesh(brainstemGeometry, brainstemMaterial);
            brainstem.position.set(0, -0.8, -0.3);
            brainstem.userData.region = 'brainstem';
            brainGroup.add(brainstem);
            
            // æ·»åŠ åŒºåŸŸæ ‡è¯†
            mainBrain.userData.region = 'frontal';
            
            brain = brainGroup;
            scene.add(brain);
            isLoaded = true;
            document.getElementById('loading').style.display = 'none';
        }
        
        function onMouseMove(event) {
            if (!isLoaded) return;
            
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(brain, true);
            
            
            // é«˜äº®æ‚¬åœçš„å¯¹è±¡
            if (intersects.length > 0) {
                const hoveredObject = intersects[0].object;
                if (hoveredObject.material) {
                    hoveredObject.material.emissive.setHex(0x444444);
                }
                document.body.style.cursor = 'pointer';
            } else {
                document.body.style.cursor = 'default';
            }
        }
        
        function onMouseClick(event) {
            if (!isLoaded) return;
            
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(brain, true);
            
            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                const position = intersects[0].point;
                
                // æ ¹æ®ç‚¹å‡»ä½ç½®ç¡®å®šå¤§è„‘åŒºåŸŸ
                let region = determineRegion(position, clickedObject);
                showRegionInfo(region);
            }
        }
        
        function determineRegion(position, object) {
            // å¦‚æœå¯¹è±¡æœ‰regionæ•°æ®ï¼Œä¼˜å…ˆä½¿ç”¨
            if (object.userData.region) {
                return object.userData.region;
            }
            
            // æ ¹æ®3Dä½ç½®åˆ¤æ–­åŒºåŸŸ
            const x = position.x;
            const y = position.y;
            const z = position.z;
            
            if (y < -0.5) {
                if (z < -0.5) return 'cerebellum';
                return 'brainstem';
            } else if (z > 0.5) {
                return 'frontal';
            } else if (z < -0.3) {
                return 'occipital';
            } else if (Math.abs(x) > 0.7) {
                return 'temporal';
            } else {
                return 'parietal';
            }
        }
        
        function showRegionInfo(region) {
            const info = brainRegions[region] || brainRegions.default;
            
            document.getElementById('region-title').textContent = info.title;
            document.getElementById('region-description').textContent = info.description;
            document.getElementById('region-functions').textContent = info.functions;
            document.getElementById('info-panel').classList.add('show');
        }
        
        function closeInfoPanel() {
            document.getElementById('info-panel').classList.remove('show');
        }
        
        function setupMouseControls() {
            let mouseDown = false;
            let mouseX = 0;
            let mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', function(e) {
                mouseDown = true;
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            renderer.domElement.addEventListener('mouseup', function() {
                mouseDown = false;
            });
            
            renderer.domElement.addEventListener('mousemove', function(e) {
                if (!mouseDown || !isLoaded || !window.brainGroup) return;
                
                const deltaX = e.clientX - mouseX;
                const deltaY = e.clientY - mouseY;
                
                brainGroup.rotation.y += deltaX * 0.01;
                brainGroup.rotation.x += deltaY * 0.01;
                
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            renderer.domElement.addEventListener('wheel', function(e) {
                if (!isLoaded) return;
                
                camera.position.z += e.deltaY * 0.001;
                camera.position.z = Math.max(1.5, Math.min(5, camera.position.z));
            });

            renderer.domElement.addEventListener('contextmenu', function(e) {
                e.stopPropagation(); // é¿å…å†’æ³¡å³å¯ï¼Œä¸é˜»æ­¢é»˜è®¤è¡Œä¸º
                // ä¸åŠ  e.preventDefault()ï¼Œå¦åˆ™å³é”®èœå•è¢«ç¦ç”¨
            }, false);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        let angle = 0;
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }
        
        // ç­‰å¾…é¡µé¢å’ŒThree.jsåŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            // ç»™Three.jsä¸€ç‚¹æ—¶é—´åŠ è½½
            setTimeout(init, 100);
        });

        
        

    </script>
</body>
</html>